#=========================== Admin CLI ===========================

admincli:
  env:
    - name: database__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"

#=========================== Admin UI ===========================

adminui:
  resources:
    requests:
      cpu: "200m"
      memory: "128Mi"
    limits:
      cpu: "400m"
      memory: "1Gi"

  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: adminui
    - name: infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "adminui-sql-connectionstring"
          key: "VALUE"
    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: authentication__apiKey
      valueFrom:
        secretKeyRef:
          name: "adminui-apikey"
          key: "VALUE"

#=========================== Consumer API ===========================

consumerapi:
  resources:
    requests:
      cpu: "200m"
      memory: "128Mi"
    limits:
      cpu: "4000m"
      memory: "2Gi"

  replicas: 1

  httpRoute:
    enabled: true
    parentRefName: "istio-gateway"
    parentRefNamespace: "gateway"
    hostnames: ["bkb-nmshd-preprod.nbpdev.de"]
  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: consumerapi
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: authentication__jwtSigningCertificate
      valueFrom:
        secretKeyRef:
          name: "jwt-signing-certificate"
          key: "VALUE"
    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

#=========================== Database Migrator ===========================

databasemigrator:
  env:
    - name: infrastructure__sqlDatabase__provider
      value: Postgres
    - name: infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "nmshd-admin-sql-connectionstring"
          key: "VALUE"
    - name: logging__minimumLevel__default
      value: Information
    - name: logging__minimumLevel__override__Backbone
      value: Information
    - name: logging__minimumLevel__override__Microsoft
      value: Information

#=========================== Event Handler ===========================

eventhandler:
  resources:
    requests:
      cpu: "200m"
      memory: "128Mi"
    limits:
      cpu: "1000m"
      memory: "512Mi"

  replicas: 1

  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: consumerapi
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: authentication__jwtSigningCertificate
      valueFrom:
        secretKeyRef:
          name: "jwt-signing-certificate"
          key: "VALUE"
    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

#=========================== Send Identity Deletion Reminders ===========================

sendidentitydeletionreminders:
  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: consumerapi
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

#=========================== Cancel Stale Deletion Processes ===========================

cancelstaledeletionprocesses:
  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: consumerapi
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

#=========================== Actual Identity Deletion ===========================

actualidentitydeletion:
  env:
    - name: infrastructure__eventBus__subscriptionClientName
      value: consumerapi
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

#=========================== Global ===========================

#=========================== Consumer API ===========================

sseserver:
  resources:
    requests:
      cpu: "200m"
      memory: "128Mi"
    limits:
      cpu: "4000m"
      memory: "2Gi"

  httpRoute:
    enabled: true
    parentRefName: "istio-gateway"
    parentRefNamespace: "gateway"
    hostnames: ["bkb-nmshd-preprod.nbpdev.de"]
  env:
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__fcm__serviceAccounts__meinBildungsraum__serviceAccountJson
      valueFrom:
        secretKeyRef:
          name: "devices-fcm-serviceaccountjson"
          key: "VALUE"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__teamId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "TEAM_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__keyId
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "KEY_ID"
    - name: modules__devices__infrastructure__pushNotifications__directPnsCommunication__apns__keys__meinBildungsraum__PrivateKey
      valueFrom:
        secretKeyRef:
          name: "devices-apns-keyinformation"
          key: "PRIVATE_KEY"

    - name: authentication__jwtSigningCertificate
      valueFrom:
        secretKeyRef:
          name: "jwt-signing-certificate"
          key: "VALUE"
    - name: modules__challenges__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "challenges-sql-connectionstring"
          key: "VALUE"
    - name: modules__devices__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "devices-sql-connectionstring"
          key: "VALUE"
    - name: modules__files__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "files-sql-connectionstring"
          key: "VALUE"
    - name: modules__messages__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "messages-sql-connectionstring"
          key: "VALUE"
    - name: modules__quotas__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "quotas-sql-connectionstring"
          key: "VALUE"
    - name: modules__relationships__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "relationships-sql-connectionstring"
          key: "VALUE"
    - name: modules__synchronization__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "synchronization-sql-connectionstring"
          key: "VALUE"
    - name: modules__tokens__infrastructure__sqlDatabase__connectionString
      valueFrom:
        secretKeyRef:
          name: "tokens-sql-connectionstring"
          key: "VALUE"

global:
  provider: "GoogleCloud"

  serviceAccount:
    name: "gcp-service-account"

  configuration:
    infrastructure:
      eventBus:
        vendor: "GoogleCloud"
        gcpPubSubProjectId: prj-nbp-preprod-pubsub-fb13
        gcpPubSubTopicName: pubsub-nbp-preprod-topic
      sqlDatabase:
        provider: Postgres
    cors:
      allowedOrigins: "nmshd://prod;http://localhost:3090;localhost:3090;nmshd://"
      exposedHeaders: "X-Request-Time;X-Response-Time;X-Response-Duration-ms;X-Trace-Id"
    swaggerUi:
      tokenUrl: "https://bkb-nmshd-preprod.nbpdev.de/connect/token"
    modules:
      challenges:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
      devices:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
          pushNotifications:
            provider: Direct
            directPnsCommunication:
              fcm:
                apps:
                  de.bildungsraum.wallet.labs:
                    serviceAccountName: meinBildungsraum
                  de.bildungsraum.wallet.experimental:
                    serviceAccountName: meinBildungsraum
              apns:
                bundles:
                  de.bildungsraum.wallet.labs:
                    keyName: meinBildungsraum
                    serverType: Production
                  de.bildungsraum.wallet.experimental:
                    keyName: meinBildungsraum
                    serverType: Production
      files:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
          blobStorage:
            cloudProvider: "GoogleCloud"
            containerName: "bkt-prj-nbp-preprod-sov-infra-4226-nmshd-bkb-files"
      messages:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
        application:
          maxNumberOfUnreceivedMessagesFromOneSender: 40
      quotas:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
      relationships:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
      synchronization:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
      tokens:
        infrastructure:
          sqlDatabase:
            provider: "Postgres"
    logging:
      minimumLevel:
        override:
          Backbone: Warning
          Microsoft: Warning
